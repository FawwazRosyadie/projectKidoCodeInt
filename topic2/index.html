<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alam Melayu: Empire Architect</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-gold: #ffd700;
            --accent-red: #8b0000;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-light: #f4f4f4;
            --overlay: rgba(0, 0, 0, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a url('bg.png') no-repeat center center fixed;
            background-size: cover;
            color: var(--text-light);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- UI Components --- */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(2px);
        }

        header {
            padding: 1rem 2rem;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .title-area h1 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--primary-gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            background: var(--glass-bg);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 1.2rem;
        }

        .game-main {
            flex: 1;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
        }

        /* --- Lateral Panels --- */
        .panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            padding: 15px;
            transition: transform 0.3s ease;
        }

        .panel-header {
            font-family: 'Cinzel', serif;
            color: var(--primary-gold);
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- Center World Area --- */
        .world-area {
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .interactive-object {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s, filter 0.2s;
            text-align: center;
        }

        .interactive-object:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--primary-gold));
        }

        .interactive-object img {
            width: 80px;
            height: auto;
        }

        .object-label {
            display: block;
            margin-top: 5px;
            font-size: 0.8rem;
            background: rgba(0, 0, 0, 0.6);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* --- Buttons & Inputs --- */
        .btn {
            background: linear-gradient(135deg, #b8860b, #daa520);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: linear-gradient(135deg, #ffd700, #ffec8b);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.7rem;
        }

        .btn-lang {
            background: transparent;
            border: 1px solid var(--primary-gold);
            color: var(--primary-gold);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* --- Tooltips & Icons --- */
        .resource-pop {
            position: absolute;
            color: var(--primary-gold);
            font-weight: bold;
            pointer-events: none;
            animation: float-up 1s forwards;
            z-index: 100;
        }

        @keyframes float-up {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        /* --- Modals/Overlays --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal {
            background: radial-gradient(circle at top, #2c2c2c, #1a1a1a);
            border: 2px solid var(--primary-gold);
            border-radius: 20px;
            width: 600px;
            max-width: 90%;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .modal h2 {
            font-family: 'Cinzel', serif;
            color: var(--primary-gold);
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        .modal p {
            margin-bottom: 30px;
            line-height: 1.6;
            color: #ccc;
        }

        .hidden {
            display: none !important;
        }

        /* --- Government List --- */
        .gov-list {
            list-style: none;
        }

        .gov-card {
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-gold);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .gov-role {
            font-weight: bold;
            color: var(--primary-gold);
            font-size: 0.9rem;
        }

        .gov-desc {
            font-size: 0.75rem;
            color: #aaa;
        }

        /* --- Economy List --- */
        .market-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .market-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--glass-border);
        }

        .market-info h4 {
            font-size: 0.9rem;
            color: #eee;
        }

        .market-price {
            font-size: 0.8rem;
            color: var(--primary-gold);
        }

        /* --- Timer & Stars --- */
        .timer-cont {
            font-family: 'Cinzel', serif;
            color: #ff4500;
            font-weight: bold;
            font-size: 1.2rem;
            padding: 5px 15px;
            border-radius: 10px;
            border: 1px solid #ff4500;
        }

        .stars-cont {
            color: gold;
            text-shadow: 0 0 5px gold;
        }

        /* Animations */
        @keyframes shine {
            0% {
                background-position: -100% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 1000px) {
            .game-main {
                grid-template-columns: 1fr;
                overflow-y: auto;
            }

            .world-area {
                height: 400px;
            }
        }
    </style>
</head>

<body>

    <div id="game-container">
        <!-- Main Interface -->
        <header>
            <div class="title-area">
                <h1 data-key="game_title">Alam Melayu: Empire Architect</h1>
            </div>

            <div class="stats-bar">
                <div class="stat-item" title="Beras (Agriculture)">
                    <span class="stat-icon">üåæ</span>
                    <span id="stat-rice">0</span>
                </div>
                <div class="stat-item" title="Emas (Gold/Economy)">
                    <span class="stat-icon">üí∞</span>
                    <span id="stat-gold">50</span>
                </div>
                <div class="stat-item" title="Poin (Knowledge)">
                    <span class="stat-icon">üìú</span>
                    <span id="stat-score">0</span>
                </div>
                <div class="stat-item stars-cont" id="stat-stars">
                    ‚òÜ‚òÜ‚òÜ
                </div>
            </div>

            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="timer-cont" id="game-timer">05:00</div>
                <button class="btn-lang" id="btn-lang" onclick="toggleLanguage()">Bahasa Melayu</button>
            </div>
        </header>

        <main class="game-main">
            <!-- Left: Government Panel -->
            <section class="panel gov-panel">
                <div class="panel-header">
                    <span data-key="gov_panel_title">Sistem Pemerintahan</span>
                    <span class="stat-icon">üëë</span>
                </div>
                <div id="gov-scroll" class="gov-list">
                    <!-- Dynamic Content -->
                </div>
                <div style="margin-top: auto; padding-top: 15px;">
                    <p class="gov-desc" id="gov-bonus-text" data-key="gov_hint">Lantik pembesar untuk meningkatkan hasil
                        ekonomi.</p>
                </div>
            </section>

            <!-- Center: Interactive World -->
            <section class="world-area" id="world-area">
                <!-- Interactive Elements represent economic activities -->
                <div class="interactive-object" style="top: 20%; left: 30%;" onclick="collectResource('rice', event)">
                    <span style="font-size: 3rem;">üåæ</span>
                    <span class="object-label" data-key="act_farm">Sawah Padi</span>
                </div>
                <div class="interactive-object" style="bottom: 25%; left: 20%;"
                    onclick="collectResource('trade', event)">
                    <span style="font-size: 3rem;">üö¢</span>
                    <span class="object-label" data-key="act_port">Pelabuhan Trade</span>
                </div>
                <div class="interactive-object" style="top: 40%; right: 25%;"
                    onclick="collectResource('forest', event)">
                    <span style="font-size: 3rem;">üå≥</span>
                    <span class="object-label" data-key="act_forest">Hasil Hutan</span>
                </div>
                <div class="interactive-object" style="bottom: 15%; right: 35%;"
                    onclick="collectResource('sea', event)">
                    <span style="font-size: 3rem;">üêö</span>
                    <span class="object-label" data-key="act_sea">Hasil Laut</span>
                </div>
            </section>

            <!-- Right: Economy Panel -->
            <section class="panel econ-panel">
                <div class="panel-header">
                    <span data-key="econ_panel_title">Kegiatan Ekonomi</span>
                    <span class="stat-icon">‚öñÔ∏è</span>
                </div>
                <div class="market-list" id="market-list">
                    <!-- Dynamic Upgrades -->
                </div>
                <div style="margin-top: auto;">
                    <div class="gov-card" style="border-color: #00ff00;">
                        <span class="gov-role" data-key="top_score_label">Top Score</span>
                        <span id="top-score-val">0</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Start Overlay -->
    <div id="start-overlay" class="overlay">
        <div class="modal">
            <h2 data-key="start_title">Empire Architect</h2>
            <p data-key="start_desc">Manage the administration and economy of the great Malay World Kingdoms. Rise from
                a small settlement to a powerful empire!</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn" onclick="startGame()" data-key="btn_start">Begin Reign</button>
                <div style="font-size: 0.8rem; color: #888;">
                    <span data-key="instruction">Pilih Kerajaan:</span>
                    <select id="kingdom-select"
                        style="background: #333; color: white; border: 1px solid gold; padding: 5px; margin-left: 10px;">
                        <option value="funan">Funan (Pertanian)</option>
                        <option value="srivijaya">Srivijaya (Maritim)</option>
                        <option value="angkor">Angkor (Empayar Padi)</option>
                        <option value="majapahit">Majapahit (Perdagangan)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- End Overlay -->
    <div id="end-overlay" class="overlay hidden">
        <div class="modal">
            <h2 data-key="end_title">Zaman Keemasan Tamat</h2>
            <div id="end-stats" style="margin: 20px 0; font-size: 1.2rem;">
                <!-- Result stats -->
            </div>
            <p id="end-rank-text"></p>
            <button class="btn" onclick="location.reload()" data-key="btn_restart">Rule Again</button>
        </div>
    </div>

    <script>
        /* --- Translation Logic --- */
        const i18n = {
            en: {
                game_title: "Alam Melayu: Empire Architect",
                gov_panel_title: "Government System",
                econ_panel_title: "Economic Activities",
                act_farm: "Paddy Fields",
                act_port: "Trade Port",
                act_forest: "Forest Products",
                act_sea: "Sea Products",
                gov_hint: "Appoint officials to boost economic productivity.",
                top_score_label: "Empire Legacy",
                start_title: "Empire Architect",
                start_desc: "Directly manage the administration (Government) and resource flow (Economy) of a legendary Malay Kingdom. Balance your power to reach the Golden Age.",
                btn_start: "Begin Reign",
                instruction: "Choose Kingdom:",
                end_title: "Era Concluded",
                btn_restart: "Reclaim Throne",
                rank_1: "Local Settlement",
                rank_2: "Prosperous Kingdom",
                rank_3: "Maritime Power",
                rank_4: "Grand Empire",
                appoint: "Appoint",
                active: "Active",
                locked: "Locked",
                need_gold: "Need Gold",
                upgrade: "Expand",
                info_funan: "Funan: Masters of irrigation and ancient trade.",
                info_srivijaya: "Srivijaya: Dominant sea power and port hub.",
                info_angkor: "Angkor: Builders of massive hydraulic rice systems.",
                info_majapahit: "Majapahit: The center of spice trade and diplomacy.",
                msg_paddy_bonus: "Royal Datu assigned! Paddy fields productivity +50%",
                msg_port_bonus: "Syahbandar appointed! Trade income +50%",
                msg_forest_cap: "Tax collection efficient. Forest products revenue +30%"
            },
            ms: {
                game_title: "Alam Melayu: Arkitek Empayar",
                gov_panel_title: "Sistem Pemerintahan",
                econ_panel_title: "Kegiatan Ekonomi",
                act_farm: "Sawah Padi",
                act_port: "Pelabuhan",
                act_forest: "Hasil Hutan",
                act_sea: "Hasil Laut",
                gov_hint: "Lantik pembesar untuk meningkatkan hasil ekonomi.",
                top_score_label: "Legasi Empayar",
                start_title: "Arkitek Empayar",
                start_desc: "Uruskan pentadbiran (Kerajaan) dan aliran sumber (Ekonomi) Kerajaan Alam Melayu yang agung. Imbangi kuasa anda untuk mencapai Zaman Keemasan.",
                btn_start: "Mula Memerintah",
                instruction: "Pilih Kerajaan:",
                end_title: "Zaman Berakhir",
                btn_restart: "Takluk Semula",
                rank_1: "Penempatan Kecil",
                rank_2: "Kerajaan Makmur",
                rank_3: "Kuasa Maritim",
                rank_4: "Empayar Agung",
                appoint: "Lantik",
                active: "Aktif",
                locked: "Terkunci",
                need_gold: "Perlu Emas",
                upgrade: "Luaskan",
                info_funan: "Funan: Pakar pengairan dan perdagangan kuno.",
                info_srivijaya: "Srivijaya: Kuasa laut dominan dan hab pelabuhan.",
                info_angkor: "Angkor: Pembina sistem hidro padi gergasi.",
                info_majapahit: "Majapahit: Pusat perdagangan rempah dan diplomasi.",
                msg_paddy_bonus: "Datu Diraja dilantik! Produktiviti sawah +50%",
                msg_port_bonus: "Syahbandar dilantik! Pendapatan trade +50%",
                msg_forest_cap: "Pungutan cukai cekap. Hasil hutan +30%"
            }
        };

        let currentLang = 'en';

        /* --- Game State --- */
        const state = {
            gold: 50,
            rice: 0,
            score: 0,
            timer: 300, // 5 minutes
            active: false,
            kingdom: 'funan',
            officials: {
                wazir: false,
                datu: false,
                syahbandar: false,
                temenggung: false
            },
            upgrades: {
                irrigation: 0,
                fleet: 0,
                taxation: 0
            },
            stars: 0
        };

        const kingdomData = {
            funan: { bonus: 'rice', color: '#ffd700' },
            srivijaya: { bonus: 'trade', color: '#4169e1' },
            angkor: { bonus: 'rice_huge', color: '#32cd32' },
            majapahit: { bonus: 'all_round', color: '#ff4500' }
        };

        /* --- Core Logic --- */

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ms' : 'en';
            document.getElementById('btn-lang').innerText = currentLang === 'en' ? 'Bahasa Melayu' : 'English';
            updateUIStrings();
            renderGovernment();
            renderEconomy();
        }

        function updateUIStrings() {
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (i18n[currentLang][key]) {
                    el.innerText = i18n[currentLang][key];
                }
            });
        }

        function startGame() {
            state.kingdom = document.getElementById('kingdom-select').value;
            state.active = true;
            document.getElementById('start-overlay').classList.add('hidden');

            // Initialization based on kingdom
            if (state.kingdom === 'srivijaya') state.gold += 100;
            if (state.kingdom === 'angkor') state.rice += 50;

            renderGovernment();
            renderEconomy();
            startTimer();
            updateStats();

            // Background ambient check
            console.log("Game started as " + state.kingdom);
        }

        function updateStats() {
            document.getElementById('stat-gold').innerText = Math.floor(state.gold);
            document.getElementById('stat-rice').innerText = Math.floor(state.rice);
            document.getElementById('stat-score').innerText = Math.floor(state.score);

            // Stars logic
            let s = 0;
            if (state.score > 1000) s = 1;
            if (state.score > 3000) s = 2;
            if (state.score > 6000) s = 3;
            if (state.score > 10000) s = 4;
            if (state.score > 20000) s = 5;

            state.stars = s;
            document.getElementById('stat-stars').innerText = "‚òÖ".repeat(s) + "‚òÜ".repeat(5 - s);

            const top = localStorage.getItem('alamMelayuTopScore') || 0;
            document.getElementById('top-score-val').innerText = top;
            if (state.score > top) {
                localStorage.setItem('alamMelayuTopScore', Math.floor(state.score));
            }
        }

        function startTimer() {
            const timerEl = document.getElementById('game-timer');
            const interval = setInterval(() => {
                if (!state.active) {
                    clearInterval(interval);
                    return;
                }
                state.timer--;
                const mins = Math.floor(state.timer / 60);
                const secs = state.timer % 60;
                timerEl.innerText = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                // Passive resource generation
                state.gold += (state.officials.syahbandar ? 0.5 : 0.1);
                state.rice += (state.officials.datu ? 0.3 : 0.1);

                if (state.timer <= 0) {
                    endGame();
                    clearInterval(interval);
                }
                updateStats();
            }, 1000);
        }

        /* --- Government System Interactions --- */
        const govRoles = [
            { id: 'wazir', en: 'Wazir (Vizier)', ms: 'Wazir', cost: 100, bonus: 'All resources +10%', desc_en: 'Prime advisor to the King.', desc_ms: 'Penasihat utama Raja.' },
            { id: 'datu', en: 'Datu (Governor)', ms: 'Datu', cost: 150, bonus: 'Rice Production +50%', desc_en: 'Manages regional provinces and agriculture.', desc_ms: 'Menguruskan wilayah dan pertanian.' },
            { id: 'syahbandar', en: 'Syahbandar', ms: 'Syahbandar', cost: 200, bonus: 'Trade Gold +50%', desc_en: 'Harbour master managing sea trade.', desc_ms: 'Ketua pelabuhan mengurus perdagangan.' },
            { id: 'temenggung', en: 'Temenggung', ms: 'Temenggung', cost: 300, bonus: 'Passive Score +2/sec', desc_en: 'Chief of internal security and law.', desc_ms: 'Ketua keselamatan dalam negeri.' }
        ];

        function renderGovernment() {
            const container = document.getElementById('gov-scroll');
            container.innerHTML = '';

            govRoles.forEach(role => {
                const isOwned = state.officials[role.id];
                const card = document.createElement('div');
                card.className = 'gov-card';
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span class="gov-role">${currentLang === 'en' ? role.en : role.ms}</span>
                        ${isOwned ? `<span style="color:#00ff00; font-size:0.7rem;">[${i18n[currentLang].active}]</span>` : ''}
                    </div>
                    <span class="gov-desc">${currentLang === 'en' ? role.desc_en : role.desc_ms}</span>
                    <span style="font-size:0.7rem; color:gold;">${role.bonus}</span>
                    ${!isOwned ? `<button class="btn btn-small" onclick="buyOfficial('${role.id}', ${role.cost})">${i18n[currentLang].appoint} (${role.cost}üí∞)</button>` : ''}
                `;
                container.appendChild(card);
            });
        }

        function buyOfficial(id, cost) {
            if (state.gold >= cost) {
                state.gold -= cost;
                state.officials[id] = true;
                notify(`Official Appointed: ${roleName(id)}`);
                renderGovernment();
                updateStats();
            } else {
                notify(i18n[currentLang].need_gold, 'red');
            }
        }

        function roleName(id) {
            return govRoles.find(r => r.id === id)[currentLang];
        }

        /* --- Economy Interactions --- */
        function collectResource(type, event) {
            if (!state.active) return;

            let amount = 0;
            let label = "";
            let color = "white";

            switch (type) {
                case 'rice':
                    amount = 5 * (state.officials.datu ? 1.5 : 1);
                    if (state.kingdom === 'angkor') amount *= 1.5;
                    state.rice += amount;
                    state.score += amount * 2;
                    label = `+${Math.floor(amount)} üåæ`;
                    color = "#90ee90";
                    break;
                case 'trade':
                    if (state.rice < 10) {
                        notify(currentLang === 'en' ? "Need 10 Rice to Trade!" : "Perlu 10 Beras untuk Berdagang!", "orange");
                        return;
                    }
                    state.rice -= 10;
                    amount = 20 * (state.officials.syahbandar ? 1.5 : 1);
                    if (state.kingdom === 'srivijaya') amount *= 1.5;
                    state.gold += amount;
                    state.score += amount * 5;
                    label = `+${Math.floor(amount)} üí∞`;
                    color = "gold";
                    break;
                case 'forest':
                    amount = 5;
                    state.gold += amount;
                    state.score += 50;
                    label = "+50 üìú";
                    color = "#deb887";
                    break;
                case 'sea':
                    amount = 8;
                    state.gold += amount;
                    state.score += 60;
                    label = "+60 üìú";
                    color = "#add8e6";
                    break;
            }

            spawnText(event.clientX, event.clientY, label, color);
            updateStats();
        }

        function renderEconomy() {
            const container = document.getElementById('market-list');
            container.innerHTML = '';

            const upgs = [
                { id: 'irrigation', name_en: 'Advanced Irrigation', name_ms: 'Sistem Saliran', cost: 200, icon: 'üíß' },
                { id: 'fleet', name_en: 'Merchant Fleet', name_ms: 'Armada Dagang', cost: 400, icon: '‚õµ' },
                { id: 'taxation', name_en: 'Centralized Tax', name_ms: 'Cukai Pusat', cost: 600, icon: 'üìú' }
            ];

            upgs.forEach(u => {
                const level = state.upgrades[u.id];
                const cost = u.cost * (level + 1);
                const item = document.createElement('div');
                item.className = 'market-item';
                item.innerHTML = `
                    <div class="market-info">
                        <h4>${u.icon} ${currentLang === 'en' ? u.name_en : u.name_ms}</h4>
                        <span class="market-price">Lvl ${level} | Cost: ${cost}üí∞</span>
                    </div>
                    <button class="btn btn-small" onclick="buyUpgrade('${u.id}', ${cost})">${i18n[currentLang].upgrade}</button>
                `;
                container.appendChild(item);
            });
        }

        function buyUpgrade(id, cost) {
            if (state.gold >= cost) {
                state.gold -= cost;
                state.upgrades[id]++;
                state.score += 500;

                // Real effects
                if (id === 'irrigation') state.officials.datu = true; // Auto-boost

                notify(`Empire Expanded: ${id.toUpperCase()}`);
                renderEconomy();
                updateStats();
            } else {
                notify(i18n[currentLang].need_gold, 'red');
            }
        }

        /* --- Visual FX --- */
        function spawnText(x, y, text, color) {
            const el = document.createElement('div');
            el.className = 'resource-pop';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = color;
            el.innerText = text;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function notify(msg, color = 'var(--primary-gold)') {
            const note = document.createElement('div');
            note.style.position = 'fixed';
            note.style.bottom = '20px';
            note.style.left = '50%';
            note.style.transform = 'translateX(-50%)';
            note.style.background = 'rgba(0,0,0,0.8)';
            note.style.color = color;
            note.style.padding = '10px 20px';
            note.style.borderRadius = '20px';
            note.style.border = '1px solid ' + color;
            note.style.zIndex = '5000';
            note.innerText = msg;
            document.body.appendChild(note);
            setTimeout(() => {
                note.style.opacity = '0';
                note.style.transition = 'opacity 0.5s';
                setTimeout(() => note.remove(), 500);
            }, 2000);
        }

        /* --- End Game --- */
        function endGame() {
            state.active = false;
            const endOverlay = document.getElementById('end-overlay');
            const endStats = document.getElementById('end-stats');
            const rankText = document.getElementById('end-rank-text');

            endOverlay.classList.remove('hidden');

            let rank = "";
            let rankKey = "";
            if (state.score < 2000) { rankKey = "rank_1"; }
            else if (state.score < 5000) { rankKey = "rank_2"; }
            else if (state.score < 10000) { rankKey = "rank_3"; }
            else { rankKey = "rank_4"; }

            rank = i18n[currentLang][rankKey];

            endStats.innerHTML = `
                <div>${currentLang === 'en' ? 'Final Score' : 'Skor Akhir'}: <b>${Math.floor(state.score)}</b></div>
                <div>${currentLang === 'en' ? 'Wealth' : 'Kekayaan'}: <b>${Math.floor(state.gold)} üí∞</b></div>
                <div style="color: gold; font-size: 2rem; margin-top: 10px;">${"‚òÖ".repeat(state.stars)}</div>
            `;

            rankText.innerText = (currentLang === 'en' ? "Your Kingdom's Status: " : "Status Kerajaan Anda: ") + rank;
        }

        /* --- Educational Tidbits (Events) --- */
        function randomEvent() {
            if (!state.active) return;

            const events = [
                {
                    en: "Bountiful harvest in the Mekong Delta! Rice +100",
                    ms: "Penuaian melimpah di Delta Mekong! Beras +100",
                    action: () => { state.rice += 100; updateStats(); }
                },
                {
                    en: "Trade fleet arrives from China. Gold +200",
                    ms: "Armada dagang tiba dari China. Emas +200",
                    action: () => { state.gold += 200; updateStats(); }
                },
                {
                    en: "New 'Kedatuan' established. Administrative efficiency up!",
                    ms: "Sistem 'Kedatuan' baru dibentuk. Kecekapan pentadbiran meningkat!",
                    action: () => { state.score += 500; updateStats(); }
                }
            ];

            const ev = events[Math.floor(Math.random() * events.length)];
            notify(currentLang === 'en' ? ev.en : ev.ms, 'cyan');
            ev.action();
        }

        setInterval(randomEvent, 45000); // Every 45 seconds

        // Initialize display
        updateUIStrings();

        /**
         * HISTORICAL CONTEXT (Developer Notes & Content Injection)
         * 
         * Sistem Pemerintahan:
         * 1. Kerajaan Funan: Raja digelar Kurung Bnam. Pentadbiran pusat dan wilayah (7 buah).
         * 2. Kerajaan Champa: Diperintah Rajadhiraja. Dibahagi kepada 5 wilayah (Indrapura, Amaravati, etc).
         * 3. Kerajaan Srivijaya: Pentadbiran Pusat (Urusan Raja/Keluarga) dan Wilayah (Datu).
         * 4. Kerajaan Angkor: Raja sebagai Devaraja. Pentadbiran berpusat di Angkor Thom.
         * 5. Kerajaan Majapahit: Dibantu oleh Sapta Prabhu (Majlis Penasihat).
         * 
         * Kegiatan Ekonomi:
         * 1. Pertanian: Padi (Funan, Champa, Angkor, Majapahit). Baray di Angkor.
         * 2. Perdagangan: Hub bursa perdagangan (Oc-Eo, Palembang, Majapahit).
         * 3. Produk: Gaharu, Rotan, Madu, Kapur Barus, Rempah-ratus (Cengkih, Buah Pala).
         * 4. Perlombongan: Emas, Perak, Bijih Besi.
         */

    </script>
</body>

</html>