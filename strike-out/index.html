<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Circle Sum Duel</title>

<style>
body {
    margin: 0;
    background: #f4f7fb;
    font-family: "Segoe UI", sans-serif;
    text-align: center;
}

h1 {
    margin-top: 20px;
}

#status {
    font-size: 18px;
    margin: 10px;
    font-weight: bold;
}

#numbers {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 10px;
    max-width: 700px;
    margin: 20px auto;
}

.number {
    background: white;
    border: 2px solid #333;
    padding: 12px 0;
    font-size: 18px;
    cursor: pointer;
    position: relative;
}

.number.selected {
    border-color: #007bff;
    background: #e8f1ff;
}

.number.used {
    background: #ddd;
    color: #777;
    text-decoration: line-through;
    pointer-events: none;
}

.number.used::after {
    content: "‚≠ï";
    position: absolute;
    inset: 0;
    font-size: 36px;
    color: red;
    display: flex;
    align-items: center;
    justify-content: center;
}

#controls {
    margin: 15px;
}

button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
}

#opControls {
    margin: 10px;
    display: none;
}
</style>
</head>
<body>

<h1>‚≠ï Circle Sum Duel</h1>
<div id="status"></div>

<div id="numbers"></div>

<div id="opControls">
    <button onclick="setOperation('+')">Ôºã Add</button>
    <button onclick="setOperation('-')">Ôºç Subtract</button>
</div>

<div id="controls">
    <button onclick="restart()">Restart Game</button>
</div>

<script>
const numbersDiv = document.getElementById("numbers");
const statusDiv = document.getElementById("status");
const opControls = document.getElementById("opControls");

let numbers = [];
let used = new Set();
let selected = [];
let currentPlayer = 1;
let lastResult = null;
let operation = null;
let phase = "pick"; // pick / op

function init() {
    numbers = Array.from({length: 30}, (_, i) => i + 1);
    used.clear();
    selected = [];
    currentPlayer = 1;
    lastResult = null;
    operation = null;
    phase = "pick";
    opControls.style.display = "none";
    render();
    updateStatus();
}

function render() {
    numbersDiv.innerHTML = "";
    numbers.forEach(n => {
        const div = document.createElement("div");
        div.className = "number";
        div.textContent = n;

        if (used.has(n)) div.classList.add("used");
        if (selected.includes(n)) div.classList.add("selected");

        div.onclick = () => selectNumber(n);
        numbersDiv.appendChild(div);
    });
}

function updateStatus() {
    if (phase === "gameover") return;
    if (currentPlayer === 1 && lastResult === null) {
        statusDiv.textContent = "Player 1: Pick TWO numbers";
    } else {
        statusDiv.textContent = `Player ${currentPlayer}: Start from ${lastResult}, choose + or ‚àí`;
    }
}

function selectNumber(n) {
    if (used.has(n)) return;

    if (lastResult === null) {
        if (selected.length < 2) {
            selected.push(n);
        }
        if (selected.length === 2) {
            let sum = selected[0] + selected[1];
            if (!numbers.includes(sum) || used.has(sum)) {
                alert("Invalid sum!");
                selected = [];
            } else {
                finalizeMove([selected[0], selected[1], sum]);
            }
        }
    } else {
        if (phase === "pick") {
            selected = [n];
            phase = "op";
            opControls.style.display = "block";
        }
    }
    render();
}

function setOperation(op) {
    operation = op;
    let n = selected[0];
    let result = operation === "+" ? lastResult + n : lastResult - n;

    if (!numbers.includes(result) || used.has(result)) {
        alert("Invalid move!");
        selected = [];
        phase = "pick";
        opControls.style.display = "none";
        render();
        return;
    }

    finalizeMove([lastResult, n, result]);
}

function finalizeMove(nums) {
    nums.forEach(n => used.add(n));
    lastResult = nums[nums.length - 1];
    selected = [];
    operation = null;
    phase = "pick";
    opControls.style.display = "none";

    if (!hasValidMove()) {
        statusDiv.textContent = `üèÜ Player ${currentPlayer} wins!`;
        phase = "gameover";
        return;
    }

    currentPlayer = currentPlayer === 1 ? 2 : 1;
    updateStatus();
    render();
}

function hasValidMove() {
    for (let n of numbers) {
        if (!used.has(n)) {
            if (numbers.includes(lastResult + n) && !used.has(lastResult + n)) return true;
            if (numbers.includes(lastResult - n) && !used.has(lastResult - n)) return true;
        }
    }
    return false;
}

function restart() {
    init();
}

init();
</script>

</body>
</html>
